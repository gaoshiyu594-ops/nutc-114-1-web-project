<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç‰©æ£®å‹çµ±è¨ˆå­¸ | å¤§å­¸ç”Ÿç”Ÿå­˜åœ–é‘‘</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root {
            --primary-color: #ff9f43;
            --secondary-color: #54a0ff;
            --bg-color: #fffaf0;
            --card-bg: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Noto Sans TC', sans-serif;
            color: #333;
            overflow-x: hidden;
        }

        .hero-section {
            background: linear-gradient(135deg, #ff9f43 0%, #ff6b6b 100%);
            color: white;
            padding: 80px 0;
            text-align: center;
            border-bottom-left-radius: 50px;
            border-bottom-right-radius: 50px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .badge-custom {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div id="loader" class="loading-overlay">
        <div class="spinner-border text-warning" role="status"></div>
        <span class="ms-3">æ­£åœ¨æ•æ‰ç¨€æœ‰å‹•ç‰©æ•¸æ“š...</span>
    </div>

    <header class="hero-section">
        <div class="container">
            <h1 class="display-4 fw-bold">ğŸ¾ å‹•ç‰©æ£®å‹çµ±è¨ˆå­¸</h1>
            <p class="lead">æ­é–‹å¤§å­¸ç”Ÿçš„äººæ ¼ã€é›»åŠ›èˆ‡çºŒå‘½ç§˜è¨£</p>
            <div class="mt-4">
                <span id="dataCount" class="badge bg-light text-dark">æ•¸æ“šè®€å–ä¸­...</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-md-6" data-aos="fade-up">
                <div class="stat-card">
                    <h3>ğŸ­ ä½ æ˜¯ä»€éº¼ç”Ÿç‰©ï¼Ÿ</h3>
                    <p class="text-muted">å—è¨ªè€…çš„äººæ ¼ç‰¹è³ªè‡ªæˆ‘èªåŒ</p>
                    <div class="chart-container">
                        <canvas id="chartSpecies"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6" data-aos="fade-up" data-aos-delay="100">
                <div class="stat-card">
                    <h3>âš¡ æˆªæ­¢æ—¥å‰æ´¾åˆ¥</h3>
                    <p class="text-muted">å¤§å®¶éƒ½æ˜¯ä»€éº¼æ™‚å€™æ‰é–‹å§‹ç‡ƒç‡’å°å®‡å®™ï¼Ÿ</p>
                    <div class="chart-container">
                        <canvas id="chartDeadline"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-12" data-aos="zoom-in">
                <div class="stat-card text-center">
                    <h3>ğŸ”‹ å¹³å‡ç”Ÿå­˜é›»é‡</h3>
                    <div class="display-2 fw-bold text-warning" id="avgEnergy">--%</div>
                    <div class="progress mt-3" style="height: 30px; border-radius: 15px;">
                        <div id="energyBar" class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p class="mt-3 text-muted">ç›®å‰å¤§å­¸ç”Ÿçš„å¹³å‡é›»é‡å‰©é¤˜ç™¾åˆ†æ¯”</p>
                </div>
            </div>

            <div class="col-md-7" data-aos="fade-right">
                <div class="stat-card">
                    <h3>â˜• çºŒå‘½è³‡æºåˆ†æ</h3>
                    <div class="chart-container">
                        <canvas id="chartSurvival"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-5" data-aos="fade-left">
                <div class="stat-card">
                    <h3>â³ 24 å°æ™‚å»å“ªäº†ï¼Ÿ</h3>
                    <p class="text-muted">å¹³å‡æ¯æ—¥æ™‚é–“åˆ†é…ï¼ˆå°æ™‚ï¼‰</p>
                    <div class="chart-container">
                        <canvas id="chartTime"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-5 text-muted">
        <p>Â© 2024 å‹•ç‰©æ£®å‹çµ±è¨ˆå­¸ - ç¶²é ç¨‹å¼è¨­è¨ˆå°ˆæ¡ˆ</p>
    </footer>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSY7NZUZlhrODZPFRNQ40zm5MKqbIGiXLwwfFOP_C_Kc78c8jQi3OFFaK7CVqtgGY6p65PCn1aVRVyB/pub?output=csv';

        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({ duration: 1000, once: true });
            fetchData();
        });

        async function fetchData() {
            try {
                const response = await fetch(CSV_URL);
                const csvData = await response.text();
                
                Papa.parse(csvData, {
                    header: true,
                    complete: (results) => {
                        processData(results.data);
                        document.getElementById('loader').style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('æ•¸æ“šè®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª CSV é€£çµæ˜¯å¦å…¬é–‹');
            }
        }

        function processData(data) {
            // 1. åŸºç¤çµ±è¨ˆ
            document.getElementById('dataCount').innerText = `å·²æ”¶é›† ${data.length} ä»½ç”Ÿç‰©æ¨£æœ¬`;

            // 2. è™•ç† Q1ï¼šç”Ÿç‰©äººæ ¼ (index 1)
            const speciesMap = countOccurrences(data, "ä½ è¦ºå¾—è‡ªå·±æ¯”è¼ƒåƒå“ªä¸€ç¨®ç”Ÿç‰©ï¼Ÿ");
            createPieChart('chartSpecies', speciesMap);

            // 3. è™•ç† Q2ï¼šæˆªæ­¢æ—¥æ´¾åˆ¥ (index 2)
            const deadlineMap = countOccurrences(data, "ä½ æ˜¯ã€Œæˆªæ­¢æ—¥å‰ã€çš„å“ªä¸€æ´¾ï¼Ÿ");
            createBarChart('chartDeadline', deadlineMap, 'rgba(84, 160, 255, 0.7)');

            // 4. è™•ç†é›»é‡ (index 6)
            const energyValues = data.map(d => parseFloat(d["ä½ æœ€è¿‘çš„èƒ½é‡æ¢ï¼ˆé›»é‡ï¼‰æ˜¯å¤šå°‘ï¼Ÿï¼ˆ0â€“100ï¼‰"]) || 0);
            const avgEnergy = (energyValues.reduce((a, b) => a + b, 0) / energyValues.length).toFixed(1);
            animateEnergy(avgEnergy);

            // 5. è™•ç†çºŒå‘½ (è¤‡é¸é¡Œè™•ç†)
            const survivalItems = [];
            data.forEach(d => {
                const items = d["ä½ æœ€å¸¸é ä»€éº¼çºŒå‘½ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰"] ? d["ä½ æœ€å¸¸é ä»€éº¼çºŒå‘½ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰"].split(', ') : [];
                survivalItems.push(...items);
            });
            const survivalMap = countArrayOccurrences(survivalItems);
            createRadarChart('chartSurvival', survivalMap);

            // 6. è™•ç†æ™‚é–“åˆ†é… (å¹³å‡å€¼)
            const timeLabels = ["ä¸€å¤©ä¸Šèª²ï¼‹è®€æ›¸ï¼ˆå°æ™‚ï¼‰", "ä¸€å¤©æ‰“å·¥/ç¤¾åœ˜ï¼ˆå°æ™‚ï¼‰", "ä¸€å¤©è¿½åŠ‡/éŠæˆ²/ç¤¾ç¾¤ï¼ˆå°æ™‚ï¼‰", "ä¸€å¤©ç¡è¦ºï¼ˆå°æ™‚ï¼‰"];
            const timeAverages = timeLabels.map(label => {
                const vals = data.map(d => parseFloat(d[label]) || 0);
                return (vals.reduce((a,b) => a+b, 0) / vals.length).toFixed(1);
            });
            createDoughnutChart('chartTime', timeLabels, timeAverages);
        }

        // --- å°å·¥å…·ï¼šè¨ˆç®—é »ç‡ ---
        function countOccurrences(data, key) {
            return data.reduce((acc, curr) => {
                const val = curr[key];
                if (val) acc[val] = (acc[val] || 0) + 1;
                return acc;
            }, {});
        }

        function countArrayOccurrences(arr) {
            return arr.reduce((acc, val) => {
                acc[val] = (acc[val] || 0) + 1;
                return acc;
            }, {});
        }

        // --- å‹•ç•«æ•ˆæœ ---
        function animateEnergy(target) {
            const el = document.getElementById('avgEnergy');
            const bar = document.getElementById('energyBar');
            let current = 0;
            const timer = setInterval(() => {
                if (current >= target) {
                    clearInterval(timer);
                } else {
                    current++;
                    el.innerText = current + '%';
                    bar.style.width = current + '%';
                }
            }, 20);
        }

        // --- Chart.js åœ–è¡¨ç”¢ç”Ÿå™¨ ---
        function createPieChart(id, dataMap) {
            new Chart(document.getElementById(id), {
                type: 'pie',
                data: {
                    labels: Object.keys(dataMap),
                    datasets: [{
                        data: Object.values(dataMap),
                        backgroundColor: ['#ff9f43', '#ee5253', '#10ac84', '#54a0ff', '#5f27cd', '#c8d6e5']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function createBarChart(id, dataMap, color) {
            new Chart(document.getElementById(id), {
                type: 'bar',
                data: {
                    labels: Object.keys(dataMap),
                    datasets: [{
                        label: 'äººæ•¸',
                        data: Object.values(dataMap),
                        backgroundColor: color,
                        borderRadius: 10
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        function createRadarChart(id, dataMap) {
            new Chart(document.getElementById(id), {
                type: 'radar',
                data: {
                    labels: Object.keys(dataMap),
                    datasets: [{
                        label: 'çºŒå‘½åå¥½',
                        data: Object.values(dataMap),
                        backgroundColor: 'rgba(255, 159, 67, 0.2)',
                        borderColor: '#ff9f43',
                        pointBackgroundColor: '#ff9f43'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function createDoughnutChart(id, labels, values) {
            new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: {
                    labels: ['è®€æ›¸', 'æ‰“å·¥/ç¤¾åœ˜', 'ä¼‘é–’', 'ç¡è¦º'],
                    datasets: [{
                        data: values,
                        backgroundColor: ['#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1']
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    cutout: '60%'
                }
            });
        }
    </script>
</body>
</html>
